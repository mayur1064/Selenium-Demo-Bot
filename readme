#!/bin/bash

# Variables
LOG_DIR="/path/to/log/files"            # Directory where log files are stored
OUTPUT_DIR="/path/to/output/directory"  # Directory to store output
START_DATE="2024-10-10"                 # Start date for filtering files
SEARCH_STRING="your_search_string"      # String to search in log files

# Convert START_DATE to seconds since 1970-01-01 (Epoch time)
START_DATE_EPOCH=$(date -d "$START_DATE" +%s)

# Create output directory if it doesn't exist
mkdir -p "$OUTPUT_DIR"

# Loop through log files in LOG_DIR
for file in "$LOG_DIR"/service-*.log; do
  # Extract the date part from the file name (assuming format service-YYYY-MM-DD.0.log)
  FILE_DATE=$(basename "$file" | cut -d'-' -f2-4 | cut -d'.' -f1)

  # Convert file date to seconds since 1970-01-01 (Epoch time)
  FILE_DATE_EPOCH=$(date -d "$FILE_DATE" +%s)

  # Check if file date is greater than or equal to START_DATE
  if [ "$FILE_DATE_EPOCH" -ge "$START_DATE_EPOCH" ]; then
    # Grep the file for the search string and write to the output directory
    grep "$SEARCH_STRING" "$file" > "$OUTPUT_DIR/$(basename "$file")"
  fi
done
