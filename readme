terraform {
  required_version = ">= 1.5.0"

  required_providers {
    azurerm = {
      source  = "hashicorp/azurerm"
      version = "~> 4.0"
    }
  }
}

provider "azurerm" {
  features {}
}

# =====================================================
# 1Ô∏è‚É£ Existing Key Vault Definition (already in Azure)
# =====================================================
resource "azurerm_key_vault" "existing_kv" {
  name                = "my-keyvault"            # <-- Replace with your vault name
  resource_group_name = "my-rg"                  # <-- Replace with your RG name
  location            = "eastus"                 # <-- Replace with your region
  tenant_id           = "00000000-0000-0000-0000-000000000000"  # <-- Replace
  sku_name            = "standard"
}

# =====================================================
# 2Ô∏è‚É£ Existing Access Policy to be Updated
# =====================================================
resource "azurerm_key_vault_access_policy" "update_policy" {
  key_vault_id = azurerm_key_vault.existing_kv.id

  tenant_id = "00000000-0000-0000-0000-000000000000"  # <-- Replace
  object_id = "11111111-1111-1111-1111-111111111111"  # <-- Replace (user/SP/object ID)

  # Keep key permissions same as before
  key_permissions = [
    "Get",
    "List"
  ]

  # Update secret permissions here üëá
  secret_permissions = [
    "Get",
    "List",
    "Set",
    "Delete"  # Newly added permission
  ]
}

# =====================================================
# 3Ô∏è‚É£ Import existing Key Vault & Access Policy into State
# =====================================================
import {
  to = azurerm_key_vault.existing_kv
  id = "/subscriptions/<SUBSCRIPTION_ID>/resourceGroups/my-rg/providers/Microsoft.KeyVault/vaults/my-keyvault"
}

import {
  to = azurerm_key_vault_access_policy.update_policy
  id = "/subscriptions/<SUBSCRIPTION_ID>/resourceGroups/my-rg/providers/Microsoft.KeyVault/vaults/my-keyvault/objectId/11111111-1111-1111-1111-111111111111"
}