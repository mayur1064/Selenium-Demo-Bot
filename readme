#!/bin/bash

# Exit on error
set -e

# Directory to store PID files
PID_DIR="./pids"
mkdir -p "$PID_DIR"

# Function to kill a process by service name
kill_service() {
    local name=$1
    pid=$(pgrep -f "$name" || true)

    if [[ -n "$pid" ]]; then
        echo "Killing $name (PID: $pid)..."
        kill -9 $pid
    else
        echo "No running process found for $name"
    fi
}

# Function to start a service and store its PID
start_service() {
    local name=$1
    local jar_path="/path/to/${name}.jar"  # <-- Update this to match your actual JAR paths

    if [[ ! -f "$jar_path" ]]; then
        echo "JAR file not found for $name at $jar_path"
        return
    fi

    echo "Starting $name..."
    nohup java -jar "$jar_path" > "${name}.log" 2>&1 &

    new_pid=$!
    echo $new_pid > "$PID_DIR/${name}.pid"
    echo "$name started with PID $new_pid"
}

# Main logic
if [[ $# -eq 0 ]]; then
    echo "Usage: $0 <service1> <service2> ..."
    exit 1
fi

for service in "$@"; do
    kill_service "$service"
    sleep 2
    start_service "$service"
done
